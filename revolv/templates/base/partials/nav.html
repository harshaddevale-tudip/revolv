{% comment %}
    We have to load staticfiles here, even though it's already loaded
    in the base template, because of how django does staticfile processing:
    http://stackoverflow.com/questions/22650371/django-is-it-impossible-to-static-tag-into-block-tag
{% endcomment %}
{% load staticfiles revolv_cms_tags %}

<header id="demo" class="header after-scroll-header after-scroll-header-fixed {% block "header-classes" %}{% endblock "header-classes" %}">
    <div class="container">
        <div class="lefts pull-left">
            <a href="/" class="logo"></a>
        </div>
        {% block "extra-header" %}{% endblock %}
        <!-- end .logo -->
        <div class="rights pull-right">
            <div class="pull-left">
                {% if request.user.is_authenticated %}
                    <li class="user-controls has-dropdown">
                        <a href="{% url 'dashboard' %}" class="btn-blue pull-left btn-donate">MY PORTFOLIO</a>
                        <a href="{% url 'logout' %}" class="btn-blue pull-left btn-donate">SIGN OUT</a>
                    </li>
                {% else %}
                        <a href="{% url 'signin' %}#login" class="component-link btn-blue pull-left btn-donate" data-component="login">SIGN IN</a>
                        <a href="{% url 'signin' %}#signup" class="component-link btn-blue pull-left btn-donate" data-component="signup">SIGN UP</a>
                {% endif %}
            </div>
             <a href="#" class="btn-blue btn-donate pull-left after-scroll" data-toggle="modal" data-target="#popup">DONATE NOW</a>
        </div>
    </div>

</header>
<div class="modal fade" id="popup" role="dialog">
    <div class="modal-dialog" style="padding:14vmin 8% 0">

      <!-- Modal content-->
      <div class="modal-content" >
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title"><b>Donation to Operations</b></h4>
        </div>
        <form action="{% url 'project:stripe_operation_donation' %}" method="POST">
          {% csrf_token %}
           <div class="modal-body input-group">
                        <input type="number" name="amount_cents" value="10" step="1" class="form-control" >
                          <span class="input-group-addon">$</span>
                      </div>
          <!--<div class="modal-body">-->
            <!--<input type="email" style="width:100%" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="Donation Amount">-->
          <!--</div>-->
          <div class="modal-section">
          <label class="checkbox-field-label" style="margin-left:5%;margin-bottom:5%">
            <input  id="subscribe-check" name="check" type="checkbox"><span><b>Subscribe me 					to the RE-volv donate operations.</b></span>
                </label>
          </div>
          <div class="modal-footer" style="text-align: center;">
            <button type="submit" class="stripe-button-el btn btn-primary" data-dismiss="modal">Next</button>
          </div>
        </form>
      </div>

    </div>
  </div>
<script src="https://checkout.stripe.com/checkout.js"></script>
<script>
  $(function ($) {
  var handler = StripeCheckout.configure({
    key: '{{ stripe_publishable_key }}'
    , image: '{% static "images/revolv-logo.png" %}'
    , locale: 'auto'
    , name: 'RE-volv'
    , email: '{{request.user.email}}'
  });
  $(window).on('popstate', function () {
    handler.close();
  });
  $('.stripe-button-el').on('click', function (e) {
    e.preventDefault();
    var $form = $(this).closest('form');
    var serialized = $form.serializeArray();
    var endpoint = $form.attr('action');
    var amount, metadata;
    $.each(serialized, function () {
      if (this.name === 'amount_cents') {
        amount = this.value*100;
      }
      if (this.name === 'metadata') {
        metadata = this.value;
      }
    });
    if (typeof amount !== 'undefined') {
      handler.open({
        description: 'Donate $' + parseFloat((amount / 100).toFixed(2)).toLocaleString()
        , amount: amount
        , metadata: metadata
        , token: function (token) {
          var id = token.id;
          var email = token.email;
          var $id = $('<input>')
            .attr('type', 'hidden')
            .attr('name', 'stripeToken')
            .val(id);
          var $email = $('<input>')
            .attr('type', 'hidden')
            .attr('name', 'stripeEmail')
            .val(email);
          $id.appendTo($form);
          $email.appendTo($form);
          $form.trigger('submit');
        }
      });
    }
  });
});
</script>
<!-- end .header -->
<!-- end .top-section -->
